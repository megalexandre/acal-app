"use strict";(self.webpackChunkvelzon=self.webpackChunkvelzon||[]).push([[371],{371:(ne,f,a)=>{a.r(f),a.d(f,{WaterQualityModule:()=>te});var c=a(177),o=a(9417),d=a(9005),b=a(8147),y=a(7038),g=a(5464),F=a(6411),C=a(115),k=a(3887),E=a(7673),I=a(5312),e=a(3953),j=a(1626);let u=(()=>{class n{constructor(t){this.http=t,this.apiUrl=`${I.c.apiUrl}/water-quality`}get(){return this.http.get(this.apiUrl)}create(t){return this.http.post(this.apiUrl,t)}update(t){return this.http.put(this.apiUrl,t)}delete(t){return this.http.delete(`${this.apiUrl}/${t}`)}getWaterParams(){return(0,E.of)([{name:"Cloro - Min 0,2 mg/l"},{name:"Coliformes Totais"},{name:"Cor aparente - 15UH"},{name:"Eschirichia Coli"},{name:"Turbidez - 5.0 UT"}])}static{this.\u0275fac=function(r){return new(r||n)(e.KVO(j.Qq))}}static{this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var p=a(1188),R=a(467),h=a(9459);class _{static valid(){return s=>{const t=s.value;if(!t)return null;const r=t.substring(0,4),i=t.substring(4,6),l=parseInt(r,10),v=parseInt(i,10);return l<1900?{invalidYear:!0}:v<1||v>12?{invalidMonth:!0}:null}}}var T=a(9830);const G=(n,s)=>({"is-invalid":n,"is-valid":s});function $(n,s){1&n&&(e.j41(0,"div"),e.EFF(1,"Campo obrigat\xf3rio"),e.k0s())}function A(n,s){1&n&&(e.j41(0,"div"),e.EFF(1,"Formato inv\xe1lido (use YYYY-MM)"),e.k0s())}function Q(n,s){1&n&&(e.j41(0,"div"),e.EFF(1,"Ano deve ser maior que 1900"),e.k0s())}function Y(n,s){1&n&&(e.j41(0,"div"),e.EFF(1,"M\xeas deve ser entre 01 e 12"),e.k0s())}function x(n,s){if(1&n&&(e.j41(0,"div",2),e.DNE(1,$,2,0,"div",3)(2,A,2,0,"div",3)(3,Q,2,0,"div",3)(4,Y,2,0,"div",3),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.reference.hasError("required")),e.R7$(),e.Y8G("ngIf",t.reference.hasError("pattern")),e.R7$(),e.Y8G("ngIf",t.reference.hasError("invalidYear")),e.R7$(),e.Y8G("ngIf",t.reference.hasError("invalidMonth"))}}let V=(()=>{class n{constructor(){this.placeholder="YYYY-MM"}ngOnChanges(t){t.reference&&this.reference&&(this.reference.setValidators([...this.reference.validator?[this.reference.validator]:[],o.k0.required,_.valid()]),this.reference.updateValueAndValidity()),t.submitted&&!0===t.submitted.currentValue&&!0!==t.submitted.previousValue&&(this.reference.markAsTouched(),this.reference.updateValueAndValidity())}isInvalid(){return!!this.submitted&&this.reference?.touched&&this.reference?.invalid}isValid(){return!!this.submitted&&this.reference?.touched&&this.reference?.valid}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-input-reference"]],inputs:{reference:"reference",submitted:"submitted",placeholder:"placeholder"},features:[e.OA$],decls:3,vars:8,consts:[["type","text","mask","0000-00",1,"form-control",3,"formControl","ngClass","placeholder"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"],[4,"ngIf"]],template:function(r,i){1&r&&(e.nrm(0,"input",0),e.EFF(1),e.DNE(2,x,5,4,"div",1)),2&r&&(e.Y8G("formControl",i.reference)("ngClass",e.l_i(5,G,i.isInvalid(),i.isValid()))("placeholder",i.placeholder),e.R7$(),e.SpI(" ",i.submitted," "),e.R7$(),e.Y8G("ngIf",i.isInvalid()))},dependencies:[c.YU,c.bT,o.me,o.BC,o.l_,T.Zr],encapsulation:2})}}return n})();const m=(n,s)=>({"is-invalid":n,"is-valid":s});function W(n,s){if(1&n){const t=e.RV6();e.j41(0,"div",20)(1,"h5",21),e.EFF(2,"Coleta"),e.k0s(),e.j41(3,"button",22),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.close())}),e.k0s()()}}function N(n,s){1&n&&(e.j41(0,"div",23),e.EFF(1,"V\xe1lido"),e.k0s())}function M(n,s){1&n&&(e.qex(0),e.EFF(1," N\xfamero \xe9 obrigat\xf3rio "),e.bVm())}function U(n,s){if(1&n&&(e.j41(0,"div",24),e.DNE(1,M,2,0,"ng-container",25),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",null==t.reference||null==t.reference.errors?null:t.reference.errors.required)}}function D(n,s){if(1&n&&(e.j41(0,"tr",26)(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.nrm(4,"input",27),e.k0s(),e.j41(5,"td"),e.nrm(6,"input",28),e.k0s(),e.j41(7,"td"),e.nrm(8,"input",29),e.k0s()()),2&n){const t=s.index,r=e.XpG();e.Y8G("formGroupName",t),e.R7$(2),e.SpI(" ",r.waterParams[t].name," "),e.R7$(2),e.Y8G("ngClass",e.l_i(5,m,r.isAnalysisInvalid(t,"required"),r.isAnalysisValid(t,"required"))),e.R7$(2),e.Y8G("ngClass",e.l_i(8,m,r.isAnalysisInvalid(t,"analyzed"),r.isAnalysisValid(t,"analyzed"))),e.R7$(2),e.Y8G("ngClass",e.l_i(11,m,r.isAnalysisInvalid(t,"conformity"),r.isAnalysisValid(t,"conformity")))}}let S=(()=>{class n{constructor(t,r,i){this.fb=t,this.service=r,this.activeModal=i,this.sent=new e.bkB,this.submitted=!1,this.waterParams=[],this.loaded=!1}ngOnInit(){this.service.getWaterParams().subscribe({next:t=>{this.waterParams=t,this.initForm()}})}initForm(){this.form=this.fb.group({reference:["",[o.k0.required,o.k0.pattern(/^\d{4}\d{2}$/)]],analysis:this.fb.array(this.waterParams.map(t=>this.createAnalysisGroup(t)))})}createAnalysisGroup(t){return this.fb.group({name:[t.name,o.k0.required],analyzed:[10,o.k0.required],required:[10,o.k0.required],conformity:[10,o.k0.required]})}onSubmit(){var t=this;return(0,R.A)(function*(){t.submitted=!0,t.form.markAllAsTouched(),t.form.valid&&t.service.create(t.form.value).subscribe({next:()=>{t.sent.emit(),t.close()},error:r=>{t.form.reset()}})})()}markAllAsTouched(){this.form.markAllAsTouched(),this.analysisArray.controls.forEach(t=>{t.markAllAsTouched()})}isFieldInvalid(t){const r=this.form.get(t);return r?.invalid&&(r?.dirty||r?.touched)||!1}isAnalysisInvalid(t,r){const i=this.analysisArray.at(t).get(r);return this.submitted&&i?.invalid||!1}isAnalysisValid(t,r){const i=this.analysisArray.at(t).get(r);return this.submitted&&i?.valid||!1}get analysis(){return this.form.get("analysis")}get reference(){return this.form.get("reference")}get analysisArray(){return this.form.get("analysis")}close(){this.activeModal.close()}isValid(t){return this.getControl(t)?.valid&&this.submitted||!1}isInvalid(t){return this.getControl(t)?.invalid&&this.submitted||!1}getControl(t){return this.form.get(t)}static{this.\u0275fac=function(r){return new(r||n)(e.rXU(o.ok),e.rXU(u),e.rXU(d.Lw))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-water-quality-create"]],outputs:{sent:"sent"},decls:31,vars:7,consts:[[3,"ngSubmit","formGroup"],["class","modal-header",4,"ngIf"],[1,"modal-body"],[1,"mb-3"],[1,"form-label"],[1,"text-danger"],[3,"reference","submitted"],["class","valid-feedback",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],[1,"table-responsive"],[1,"table","table-bordered","table-striped"],[1,"table-dark"],["width","30%"],["width","20%"],["formArrayName","analysis"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"modal-footer"],[1,"d-flex","justify-content-between","col-12"],["type","button","btnType","secondary","outline","",3,"click"],["type","submit","btnType","success","outline",""],[1,"modal-header"],[1,"modal-title"],["type","button","outline","","aria-label","Close",1,"btn-close",3,"click"],[1,"valid-feedback"],[1,"invalid-feedback"],[4,"ngIf"],[3,"formGroupName"],["type","text","formControlName","required",1,"form-control",3,"ngClass"],["type","text","formControlName","analyzed",1,"form-control",3,"ngClass"],["type","text","formControlName","conformity",1,"form-control",3,"ngClass"]],template:function(r,i){1&r&&(e.j41(0,"form",0),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.DNE(1,W,4,0,"div",1),e.j41(2,"div",2)(3,"div",3)(4,"label",4),e.EFF(5,"Refer\xeancia: "),e.j41(6,"span",5),e.EFF(7,"*"),e.k0s()(),e.nrm(8,"app-input-reference",6),e.DNE(9,N,2,0,"div",7)(10,U,2,1,"div",8),e.k0s(),e.j41(11,"div",9)(12,"table",10)(13,"thead",11)(14,"tr")(15,"th",12),e.EFF(16,"Nome:"),e.k0s(),e.j41(17,"th",13),e.EFF(18,"Exigido:"),e.k0s(),e.j41(19,"th",13),e.EFF(20,"Analisado:"),e.k0s(),e.j41(21,"th",13),e.EFF(22,"Conforme:"),e.k0s()()(),e.j41(23,"tbody",14),e.DNE(24,D,9,14,"tr",15),e.k0s()()()(),e.j41(25,"div",16)(26,"div",17)(27,"app-button",18),e.bIt("click",function(){return i.close()}),e.EFF(28," Cancelar "),e.k0s(),e.j41(29,"app-button",19),e.EFF(30," Salvar "),e.k0s()()()()),2&r&&(e.Y8G("formGroup",i.form),e.R7$(),e.Y8G("ngIf",i.loaded),e.R7$(7),e.Y8G("reference",i.reference)("submitted",i.submitted),e.R7$(),e.Y8G("ngIf",i.isValid("referencia")),e.R7$(),e.Y8G("ngIf",i.isInvalid("referencia")),e.R7$(14),e.Y8G("ngForOf",i.analysisArray.controls))},dependencies:[c.YU,c.Sq,c.bT,o.qT,o.me,o.BC,o.cb,o.j4,o.JD,o.$R,o.v8,h.Q,V],encapsulation:2})}}return n})(),X=(()=>{class n{constructor(t,r){this.service=t,this.activeModal=r,this.sent=new e.bkB}close(){this.activeModal.dismiss("cancel")}confirm(){this.service.delete(this.waterQuality.id).subscribe({next:()=>{this.close(),this.sent.emit()}})}static{this.\u0275fac=function(r){return new(r||n)(e.rXU(u),e.rXU(d.Lw))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-water-quality-delete"]],inputs:{waterQuality:"waterQuality"},outputs:{sent:"sent"},decls:20,vars:1,consts:[[1,"modal-content"],[1,"modal-header"],["type","button","data-bs-dismiss","modal","aria-label","Close","id","btn-close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mt-2","text-center"],[1,"text-danger","d-inline-block","remove-item-btn"],[1,"ri-delete-bin-5-fill","fs-48"],[1,"mt-4","pt-2","fs-15","mx-4","mx-sm-5"],[1,"text-muted","mx-4","mb-0"],[1,"d-flex","gap-2","justify-content-center","mt-4","mb-2"],["data-bs-dismiss","modal","id","deleteRecord-close",1,"btn","btn-link","link-success","fw-medium","text-decoration-none",3,"click"],[1,"ri-close-line","me-1","align-middle"],["type","button","id","delete-product",1,"btn","w-sm","btn-danger",3,"click"]],template:function(r,i){1&r&&(e.j41(0,"div",0)(1,"div",1)(2,"button",2),e.bIt("click",function(){return i.close()}),e.k0s()(),e.j41(3,"div",3)(4,"div",4)(5,"a",5),e.nrm(6,"i",6),e.k0s(),e.j41(7,"div",7)(8,"h4"),e.EFF(9,"Voc\xea est\xe1 certo que quer deletar isso ?"),e.k0s(),e.j41(10,"p",8),e.EFF(11,"Essa a\xe7\xe3o n\xe3o pode ser desfeita."),e.k0s(),e.j41(12,"p",8),e.EFF(13),e.k0s()()(),e.j41(14,"div",9)(15,"button",10),e.bIt("click",function(){return i.close()}),e.nrm(16,"i",11),e.EFF(17," Cancelar "),e.k0s(),e.j41(18,"button",12),e.bIt("click",function(){return i.confirm()}),e.EFF(19," Sim, Eu quero deletar! "),e.k0s()()()()),2&r&&(e.R7$(13),e.JRh(i.waterQuality.reference))},encapsulation:2})}}return n})();var w=a(7509),B=a(6364),O=a(6356),z=a(7186),q=a(43);function J(n,s){if(1&n&&(e.j41(0,"td"),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2).$implicit;e.BMQ("rowspan",t.analysis.length),e.R7$(),e.JRh(t.reference)}}function P(n,s){if(1&n){const t=e.RV6();e.j41(0,"td",10)(1,"button",15),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2).$implicit,l=e.XpG();return e.Njj(l.delete(i))}),e.nrm(2,"i",16),e.k0s()()}if(2&n){const t=e.XpG(2).$implicit;e.BMQ("rowspan",t.analysis.length)}}function H(n,s){if(1&n&&(e.qex(0),e.j41(1,"tr"),e.DNE(2,J,2,2,"td",13),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.DNE(11,P,3,1,"td",14),e.k0s(),e.bVm()),2&n){const t=s.$implicit,r=s.index;e.R7$(2),e.Y8G("ngIf",0==r),e.R7$(2),e.JRh(t.name),e.R7$(2),e.JRh(t.analyzed),e.R7$(2),e.JRh(t.conformity),e.R7$(2),e.JRh(t.required),e.R7$(),e.Y8G("ngIf",0==r)}}function L(n,s){if(1&n&&(e.qex(0),e.DNE(1,H,12,6,"ng-container",11),e.bVm()),2&n){const t=s.$implicit;e.R7$(),e.Y8G("ngForOf",t.analysis)}}function K(n,s){1&n&&(e.j41(0,"div",17),e.nrm(1,"div",18),e.k0s())}const Z=[{path:"",component:(()=>{class n{constructor(t,r,i){this.service=t,this.modalService=r,this.toastService=i,this.breadCrumbItems=[],this.analises=[],this.loaded=!1}ngOnInit(){this.breadCrumbItems=[{label:"Dashboards"},{label:"Coletas",active:!0}],this.search()}search(){this.loaded=!1,this.service.get().subscribe({next:t=>{this.analises=t},error:()=>{this.loaded=!0,this.toastService.show("Erro ao carregar dados.",{classname:"bg-danger text-white",delay:15e3})}})}create(){this.openModal(S)}delete(t){this.openModal(X,{waterQuality:t})}openModal(t,r){const l=this.modalService.open(t,{centered:!0}).componentInstance;r&&Object.assign(l,r),l.sent.subscribe(()=>this.search())}static{this.\u0275fac=function(r){return new(r||n)(e.rXU(u),e.rXU(d.Bq),e.rXU(w.f))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-water-quality"]],decls:30,vars:3,consts:[["title","Coleta",3,"breadcrumbItems"],[1,"row"],[1,"col-lg-12"],[1,"card-title","flex-grow-1","mb-0"],[1,"d-flex","gap-1","flex-wrap"],["btnType","success","outline","",3,"click"],[1,"table-responsive","table-card"],[1,"table","table-hover","table-striped","align-middle","table-nowrap","mb-0","table-gridjs"],[1,"col-1"],[1,"col-7"],[1,"text-center"],[4,"ngFor","ngForOf"],["class","text-center p-3",4,"ngIf"],[4,"ngIf"],["class","text-center",4,"ngIf"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"ri-delete-bin-5-fill"],[1,"text-center","p-3"],["role","status",1,"spinner-border","text-primary"]],template:function(r,i){1&r&&(e.nrm(0,"app-breadcrumbs",0),e.j41(1,"div",1)(2,"div",2)(3,"app-card")(4,"app-card-header")(5,"h5",3),e.EFF(6,"Coleta"),e.k0s(),e.j41(7,"div",4)(8,"app-button",5),e.bIt("click",function(){return i.create()}),e.EFF(9,"Adicionar"),e.k0s()()(),e.j41(10,"app-card-body")(11,"div",6)(12,"table",7)(13,"thead")(14,"tr")(15,"th",8),e.EFF(16,"Refer\xeancias"),e.k0s(),e.j41(17,"th",9),e.EFF(18,"Parametro"),e.k0s(),e.j41(19,"th",8),e.EFF(20,"Exigido"),e.k0s(),e.j41(21,"th",8),e.EFF(22,"Analisado"),e.k0s(),e.j41(23,"th",8),e.EFF(24,"Conforme"),e.k0s(),e.j41(25,"th",10),e.EFF(26,"A\xe7\xf5es"),e.k0s()()(),e.j41(27,"tbody"),e.DNE(28,L,2,1,"ng-container",11),e.k0s()()()(),e.DNE(29,K,2,0,"div",12),e.k0s()()()),2&r&&(e.Y8G("breadcrumbItems",i.breadCrumbItems),e.R7$(28),e.Y8G("ngForOf",i.analises),e.R7$(),e.Y8G("ngIf",i.loaded))},dependencies:[c.Sq,c.bT,B.m,h.Q,O.i,z.l,q.q],encapsulation:2})}}return n})()}];let ee=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=e.$C({type:n})}static{this.\u0275inj=e.G2t({imports:[p.iI.forChild(Z),p.iI]})}}return n})(),te=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=e.$C({type:n})}static{this.\u0275inj=e.G2t({providers:[u],imports:[g.M.pick(F.Wzl),c.MD,ee,k.G,b.h,o.X1,d.c9,C.i,o.YN,y.H]})}}return n})()}}]);
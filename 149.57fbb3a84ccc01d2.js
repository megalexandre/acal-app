"use strict";(self.webpackChunkvelzon=self.webpackChunkvelzon||[]).push([[149],{1149:(z,g,c)=>{c.r(g),c.d(g,{InvoiceModule:()=>J});var h=c(177),d=c(9417),p=c(9005),F=c(8147),k=c(5464),C=c(6411),I=c(1022),b=c(255),j=c(115),R=c(3887),y=c(1114),u=c(1188),e=c(4438),_=c(5312),E=c(1626);let v=(()=>{class o{constructor(t){this.http=t,this.apiUrl=`${_.c.apiUrl}/invoice`}get(){return this.http.get(this.apiUrl)}create(t){return this.http.post(this.apiUrl,t)}update(t){return this.http.put(this.apiUrl,t)}delete(t){return this.http.delete(`${this.apiUrl}/${t}`)}view(t){return this.http.get(`${this.apiUrl}/view/${t}`)}static{this.\u0275fac=function(i){return new(i||o)(e.KVO(E.Qq))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var $=c(7509),M=c(6364),T=c(9459),V=c(6356),S=c(7186),G=c(43),N=c(9986);function B(o,a){if(1&o){const t=e.RV6();e.j41(0,"tr")(1,"td",11),e.EFF(2),e.k0s(),e.j41(3,"td",12)(4,"ul",13)(5,"li",14),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.edit(n))}),e.nrm(6,"i",15),e.k0s(),e.j41(7,"li",16),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.delete(n))}),e.j41(8,"a",17),e.nrm(9,"i",18),e.k0s()()()()()}if(2&o){const t=a.$implicit;e.R7$(2),e.JRh(t.reference)}}const f=o=>({"table-success":o});function U(o,a){if(1&o&&(e.j41(0,"option",9),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(),e.JRh(t)}}function w(o,a){if(1&o&&(e.j41(0,"option",9),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(),e.JRh(t)}}function D(o,a){if(1&o){const t=e.RV6();e.j41(0,"tr",31),e.bIt("click",function(){const n=e.eBV(t).$implicit;return e.Njj(n.checked=!n.checked)}),e.j41(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.nI1(11,"currency"),e.k0s(),e.j41(12,"td"),e.EFF(13),e.k0s(),e.j41(14,"td"),e.EFF(15),e.nI1(16,"currency"),e.k0s(),e.j41(17,"td",28)(18,"input",29),e.mxI("ngModelChange",function(n){const r=e.eBV(t).$implicit;return e.DH7(r.checked,n)||(r.checked=n),e.Njj(n)}),e.bIt("click",function(n){return e.eBV(t),e.Njj(n.stopPropagation())}),e.k0s()()()}if(2&o){const t=a.$implicit;e.Y8G("ngClass",e.eq3(13,f,t.checked)),e.R7$(2),e.JRh(t.place.address),e.R7$(2),e.JRh(t.category.name),e.R7$(2),e.JRh(t.customer.name),e.R7$(2),e.JRh(t.place.number+" "+t.place.letter),e.R7$(2),e.JRh(e.bMT(11,9,t.category.total)),e.R7$(3),e.JRh(t.consumption),e.R7$(2),e.JRh(e.bMT(16,11,t.water_value)),e.R7$(3),e.R50("ngModel",t.checked)}}function O(o,a){if(1&o){const t=e.RV6();e.qex(0),e.j41(1,"tr",25),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.toggleGroup(n))}),e.j41(2,"td",26)(3,"div",5)(4,"div",27),e.EFF(5),e.k0s()()(),e.j41(6,"td",28)(7,"input",29),e.mxI("ngModelChange",function(n){const r=e.eBV(t).$implicit;return e.DH7(r.checked,n)||(r.checked=n),e.Njj(n)}),e.bIt("click",function(n){return e.eBV(t),e.Njj(n.stopPropagation())}),e.k0s()()(),e.DNE(8,D,19,15,"tr",30),e.bVm()}if(2&o){const t=a.$implicit,i=e.XpG();e.R7$(),e.Y8G("ngClass",e.eq3(5,f,t.checked)),e.R7$(4),e.SpI(" ",t.name," "),e.R7$(2),e.R50("ngModel",t.checked),e.R7$(),e.Y8G("ngForOf",t.items)("ngForTrackBy",i.trackBySelectableId)}}const x=[{path:"",component:(()=>{class o{constructor(t,i,n,r,s){this.router=t,this.route=i,this.invoiceService=n,this.modalService=r,this.toastService=s,this.breadCrumbItems=[],this.invoices=[],this.loading=!0}ngOnInit(){this.breadCrumbItems=[{label:"Dashboards"},{label:"Faturas",active:!0}],this.search()}search(){this.loading=!0,this.invoiceService.get().subscribe({next:t=>{this.invoices=t,this.loading=!1},error:()=>{this.loading=!1}})}create(){this.router.navigate(["create"],{relativeTo:this.route})}edit(t){}delete(t){}openModal(t,i){const r=this.modalService.open(t,{centered:!0}).componentInstance;i&&Object.assign(r,i),r.sent.subscribe(()=>this.search())}static{this.\u0275fac=function(i){return new(i||o)(e.rXU(u.Ix),e.rXU(u.nX),e.rXU(v),e.rXU(p.Bq),e.rXU($.f))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-invoice"]],decls:20,vars:2,consts:[["title","Faturas",3,"breadcrumbItems"],[1,"row"],[1,"col-lg-12"],[1,"card-title","flex-grow-1","mb-0"],[1,"d-flex","gap-1","flex-wrap"],["btnType","success","outline","",3,"click"],["table-header","",1,"table-light"],[1,"col-11"],[1,"col-1","text-center"],["table-body","",1,"list","form-check-all"],[4,"ngFor","ngForOf"],[1,"name"],[1,"text-center"],[1,"list-inline","hstack","gap-2","mb-0"],["data-bs-toggle","tooltip","data-bs-trigger","hover","ngbTooltip","Edit","placement","top",1,"list-inline-item","edit",3,"click"],[1,"ri-pencil-fill","fs-16"],["ngbTooltip","Remove","placement","top","data-bs-toggle","tooltip","data-bs-trigger","hover",1,"list-inline-item","me-0",3,"click"],[1,"text-danger","d-inline-block","remove-item-btn"],[1,"ri-delete-bin-5-fill","fs-16"]],template:function(i,n){1&i&&(e.nrm(0,"app-breadcrumbs",0),e.j41(1,"div",1)(2,"div",2)(3,"app-card")(4,"app-card-header")(5,"h5",3),e.EFF(6,"Faturas"),e.k0s(),e.j41(7,"div",4)(8,"app-button",5),e.bIt("click",function(){return n.create()}),e.EFF(9," Adicionar "),e.k0s()()(),e.j41(10,"app-card-body")(11,"app-table")(12,"thead",6)(13,"tr")(14,"th",7),e.EFF(15,"Name"),e.k0s(),e.j41(16,"th",8),e.EFF(17,"Action"),e.k0s()()(),e.j41(18,"tbody",9),e.DNE(19,B,10,1,"tr",10),e.k0s()()()()()()),2&i&&(e.Y8G("breadcrumbItems",n.breadCrumbItems),e.R7$(19),e.Y8G("ngForOf",n.invoices))},dependencies:[M.m,h.Sq,T.Q,V.i,S.l,G.q,N.O],encapsulation:2})}}return o})()},{path:"create",component:(()=>{class o{constructor(t){this.service=t,this.preview={items:[]},this.loading=!0,this.invoices=[],this.addresses=[],this.categories=[],this.filter={hasMeter:null,address:null,category:null}}ngOnInit(){this.load()}load(){this.loading=!0,this.service.view("2025-01").subscribe({next:t=>{this.invoices=t,this.preview=this.buildPreview(t),this.loading=!1},error:()=>{this.loading=!1,this.preview.items=[]}})}onchangeFilter(){let t=[...this.invoices];null!==this.filter.hasMeter&&(t=t.filter(i=>i.category.is_hydrometer===this.filter.hasMeter)),this.filter.address&&(t=t.filter(i=>i.place.address===this.filter.address)),this.filter.category&&(t=t.filter(i=>i.category.name===this.filter.category)),this.preview=this.buildPreview(t)}buildPreview(t){const i=t.map(l=>({checked:!1,...l})),n=Array.from(new Set(i.map(l=>l.place.address))).sort((l,m)=>l.localeCompare(m)),r=Array.from(new Set(i.map(l=>l.category.name))).sort((l,m)=>l.localeCompare(m)),s=n.map(l=>{const m=i.filter(A=>A.place.address===l);return{name:l,checked:!1,items:m}});return 0===this.addresses.length&&(this.addresses=n),0===this.categories.length&&(this.categories=r),{items:s}}trackByGroupId(t){return t.id}trackBySelectableId(t){return t.id}totalItems(){return this.preview.items.reduce((t,i)=>t+i.items.length,0)}totalValue(){return this.preview.items.reduce((t,i)=>t+i.items.reduce((n,r)=>n+Number(r.total),0),0)}totalISelectedtems(){return this.preview.items.reduce((t,i)=>t+i.items.filter(n=>n.checked).length,0)}totalSelectedValue(){return this.preview.items.reduce((t,i)=>t+i.items.filter(n=>n.checked).reduce((n,r)=>n+(Number(r.total)??0),0),0)}toggleGroup(t){t.checked=!t.checked,t.items.forEach(i=>i.checked=t.checked)}toggleAll(){const t=this.preview.items.every(i=>i.checked&&i.items.every(n=>n.checked));this.preview.items.forEach(i=>{i.checked=!t,i.items.forEach(n=>n.checked=!t)})}static{this.\u0275fac=function(i){return new(i||o)(e.rXU(v))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-invoice-create"]],decls:69,vars:20,consts:[[1,"d-flex","flex-column",2,"height","100vh"],[2,"height","10vh"],[1,"border","h-100"],[1,"card"],[1,"card-body"],[1,"row"],[1,"col-xxl-4","col-md-6"],[1,"form-label"],["id","group",1,"form-select",3,"ngModelChange","change","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["id","hasMeterFilter",1,"form-select",3,"ngModelChange","change","ngModel"],[2,"height","60vh"],[1,"border","h-100","d-flex","flex-column"],[1,"border","mb-0","flex-grow-1","overflow-auto"],[1,"table","table-hover","table-striped","mb-0",2,"min-width","100%"],[1,"table-light",2,"position","sticky","top","0","z-index","1"],[2,"cursor","pointer",3,"click"],[2,"width","20%"],[2,"width","15%"],[2,"width","5%"],["table-body","",1,"list","form-check-all"],[4,"ngFor","ngForOf","ngForTrackBy"],[2,"height","20vh"],[1,"col-md-3","col-12"],[1,"bg-light",3,"click","ngClass"],["colspan","7"],[1,"text-center","fw-bold",2,"font-size","16px"],[1,"text-center"],["type","checkbox",3,"ngModelChange","click","ngModel"],["style","cursor: pointer",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[2,"cursor","pointer",3,"click","ngClass"]],template:function(i,n){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"label",7),e.EFF(8,"Grupo:"),e.k0s(),e.j41(9,"select",8),e.mxI("ngModelChange",function(s){return e.DH7(n.filter.category,s)||(n.filter.category=s),s}),e.bIt("change",function(){return n.onchangeFilter()}),e.j41(10,"option",9),e.EFF(11,"Selecione..."),e.k0s(),e.DNE(12,U,2,2,"option",10),e.k0s()(),e.j41(13,"div",6)(14,"label",7),e.EFF(15,"Logradouro:"),e.k0s(),e.j41(16,"select",8),e.mxI("ngModelChange",function(s){return e.DH7(n.filter.address,s)||(n.filter.address=s),s}),e.bIt("change",function(){return n.onchangeFilter()}),e.j41(17,"option",9),e.EFF(18,"Selecione..."),e.k0s(),e.DNE(19,w,2,2,"option",10),e.k0s()(),e.j41(20,"div",6)(21,"label",7),e.EFF(22,"Tem Hidr\xf4metro?:"),e.k0s(),e.j41(23,"select",11),e.mxI("ngModelChange",function(s){return e.DH7(n.filter.hasMeter,s)||(n.filter.hasMeter=s),s}),e.bIt("change",function(){return n.onchangeFilter()}),e.j41(24,"option",9),e.EFF(25,"Selecione..."),e.k0s(),e.j41(26,"option",9),e.EFF(27,"Sim"),e.k0s(),e.j41(28,"option",9),e.EFF(29,"N\xe3o"),e.k0s()()()()()()()(),e.j41(30,"div",12)(31,"div",13)(32,"div",14)(33,"table",15)(34,"thead",16)(35,"tr",17),e.bIt("click",function(){return n.toggleAll()}),e.j41(36,"th",18),e.EFF(37,"Endereco"),e.k0s(),e.j41(38,"th",19),e.EFF(39,"Name"),e.k0s(),e.j41(40,"th",19),e.EFF(41,"Categoria"),e.k0s(),e.j41(42,"th",20),e.EFF(43,"\xc1gua/lt"),e.k0s(),e.j41(44,"th",20),e.EFF(45,"\xc1gua/Consumo"),e.k0s(),e.j41(46,"th",20),e.EFF(47,"N\xfamero"),e.k0s(),e.j41(48,"th",20),e.EFF(49,"Valor"),e.k0s(),e.j41(50,"th",20),e.EFF(51,"Selecionar"),e.k0s()()(),e.j41(52,"tbody",21),e.DNE(53,O,9,7,"ng-container",22),e.k0s()()()()(),e.j41(54,"div",23)(55,"div",2)(56,"div",3)(57,"div",4)(58,"div",5)(59,"div",24),e.EFF(60),e.k0s(),e.j41(61,"div",24),e.EFF(62),e.nI1(63,"currency"),e.k0s(),e.j41(64,"div",24),e.EFF(65),e.k0s(),e.j41(66,"div",24),e.EFF(67),e.nI1(68,"currency"),e.k0s()()()()()()()),2&i&&(e.R7$(9),e.R50("ngModel",n.filter.category),e.R7$(),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngForOf",n.categories),e.R7$(4),e.R50("ngModel",n.filter.address),e.R7$(),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngForOf",n.addresses),e.R7$(4),e.R50("ngModel",n.filter.hasMeter),e.R7$(),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngValue",!0),e.R7$(2),e.Y8G("ngValue",!1),e.R7$(25),e.Y8G("ngForOf",n.preview.items)("ngForTrackBy",n.trackByGroupId),e.R7$(7),e.SpI("Total de items: ",n.totalItems(),""),e.R7$(2),e.SpI("Valor Total: ",e.bMT(63,16,n.totalValue()),""),e.R7$(3),e.SpI("Items Selecionados: ",n.totalISelectedtems(),""),e.R7$(2),e.SpI("Valor Selecionado: ",e.bMT(68,18,n.totalSelectedValue()),""))},dependencies:[h.YU,h.Sq,d.xH,d.y7,d.Zm,d.wz,d.BC,d.vS,h.oe],encapsulation:2})}}return o})()}];let X=(()=>{class o{static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[u.iI.forChild(x),u.iI]})}}return o})();var H=c(7038);let J=(()=>{class o{static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({providers:[h.vh],imports:[R.G,X,h.MD,F.h,j.i,d.YN,d.X1,p.c9,p.h_,p.zH,b.r,k.M.pick(C.Wzl),I.ND,y.V,H.H]})}}return o})()}}]);
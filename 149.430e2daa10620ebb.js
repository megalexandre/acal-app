"use strict";(self.webpackChunkvelzon=self.webpackChunkvelzon||[]).push([[149],{1149:(J,p,s)=>{s.r(p),s.d(p,{InvoiceModule:()=>H});var d=s(177),l=s(9417),h=s(9005),f=s(8147),F=s(5464),k=s(6411),C=s(1022),I=s(255),b=s(115),j=s(3887),y=s(1114),m=s(1188),e=s(4438),R=s(5312),_=s(1626);let u=(()=>{class r{constructor(t){this.http=t,this.apiUrl=`${R.c.apiUrl}/invoice`}get(){return this.http.get(this.apiUrl)}create(t){return this.http.post(this.apiUrl,t)}update(t){return this.http.put(this.apiUrl,t)}delete(t){return this.http.delete(`${this.apiUrl}/${t}`)}preview(t){return this.http.get(`${this.apiUrl}/preview/${t}`)}static{this.\u0275fac=function(i){return new(i||r)(e.KVO(_.Qq))}}static{this.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var E=s(7509),M=s(6364),$=s(9459),T=s(6356),V=s(7186),S=s(43),B=s(9986);function G(r,a){if(1&r){const t=e.RV6();e.j41(0,"tr")(1,"td",11),e.EFF(2),e.k0s(),e.j41(3,"td",12)(4,"ul",13)(5,"li",14),e.bIt("click",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.edit(n))}),e.nrm(6,"i",15),e.k0s(),e.j41(7,"li",16),e.bIt("click",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.delete(n))}),e.j41(8,"a",17),e.nrm(9,"i",18),e.k0s()()()()()}if(2&r){const t=a.$implicit;e.R7$(2),e.JRh(t.reference)}}const g=r=>({"table-success":r});function U(r,a){if(1&r&&(e.j41(0,"option",9),e.EFF(1),e.k0s()),2&r){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(),e.JRh(t)}}function Y(r,a){if(1&r&&(e.j41(0,"option",9),e.EFF(1),e.k0s()),2&r){const t=a.$implicit;e.Y8G("ngValue",t),e.R7$(),e.JRh(t)}}function w(r,a){if(1&r){const t=e.RV6();e.j41(0,"tr",31),e.bIt("click",function(){const n=e.eBV(t).$implicit;return e.Njj(n.checked=!n.checked)}),e.j41(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.nI1(11,"currency"),e.k0s(),e.j41(12,"td"),e.EFF(13),e.k0s(),e.j41(14,"td"),e.EFF(15),e.nI1(16,"currency"),e.k0s(),e.j41(17,"td",28)(18,"input",29),e.mxI("ngModelChange",function(n){const o=e.eBV(t).$implicit;return e.DH7(o.checked,n)||(o.checked=n),e.Njj(n)}),e.bIt("click",function(n){return e.eBV(t),e.Njj(n.stopPropagation())}),e.k0s()()()}if(2&r){const t=a.$implicit;e.Y8G("ngClass",e.eq3(13,g,t.checked)),e.R7$(2),e.JRh(t.place.address),e.R7$(2),e.JRh(t.category.name),e.R7$(2),e.JRh(t.customer.name),e.R7$(2),e.JRh(t.place.number+" "+t.place.letter),e.R7$(2),e.JRh(e.bMT(11,9,t.category.total)),e.R7$(3),e.JRh(t.consumption),e.R7$(2),e.JRh(e.bMT(16,11,t.water_value)),e.R7$(3),e.R50("ngModel",t.checked)}}function D(r,a){if(1&r){const t=e.RV6();e.qex(0),e.j41(1,"tr",25),e.bIt("click",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.toggleGroup(n))}),e.j41(2,"td",26)(3,"div",5)(4,"div",27),e.EFF(5),e.k0s()()(),e.j41(6,"td",28)(7,"input",29),e.mxI("ngModelChange",function(n){const o=e.eBV(t).$implicit;return e.DH7(o.checked,n)||(o.checked=n),e.Njj(n)}),e.bIt("click",function(n){return e.eBV(t),e.Njj(n.stopPropagation())}),e.k0s()()(),e.DNE(8,w,19,15,"tr",30),e.bVm()}if(2&r){const t=a.$implicit,i=e.XpG();e.R7$(),e.Y8G("ngClass",e.eq3(5,g,t.checked)),e.R7$(4),e.SpI(" ",t.name," "),e.R7$(2),e.R50("ngModel",t.checked),e.R7$(),e.Y8G("ngForOf",t.items)("ngForTrackBy",i.trackBySelectableId)}}const O=[{path:"",component:(()=>{class r{constructor(t,i,n,o,c){this.router=t,this.route=i,this.invoiceService=n,this.modalService=o,this.toastService=c,this.breadCrumbItems=[],this.invoices=[],this.loading=!0}ngOnInit(){this.breadCrumbItems=[{label:"Dashboards"},{label:"Faturas",active:!0}],this.search()}search(){this.loading=!0,this.invoiceService.get().subscribe({next:t=>{this.invoices=t,this.loading=!1},error:()=>{this.loading=!1}})}create(){this.router.navigate(["create"],{relativeTo:this.route})}edit(t){}delete(t){}openModal(t,i){const o=this.modalService.open(t,{centered:!0}).componentInstance;i&&Object.assign(o,i),o.sent.subscribe(()=>this.search())}static{this.\u0275fac=function(i){return new(i||r)(e.rXU(m.Ix),e.rXU(m.nX),e.rXU(u),e.rXU(h.Bq),e.rXU(E.f))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-invoice"]],decls:20,vars:2,consts:[["title","Faturas",3,"breadcrumbItems"],[1,"row"],[1,"col-lg-12"],[1,"card-title","flex-grow-1","mb-0"],[1,"d-flex","gap-1","flex-wrap"],["btnType","success","outline","",3,"click"],["table-header","",1,"table-light"],[1,"col-11"],[1,"col-1","text-center"],["table-body","",1,"list","form-check-all"],[4,"ngFor","ngForOf"],[1,"name"],[1,"text-center"],[1,"list-inline","hstack","gap-2","mb-0"],["data-bs-toggle","tooltip","data-bs-trigger","hover","ngbTooltip","Edit","placement","top",1,"list-inline-item","edit",3,"click"],[1,"ri-pencil-fill","fs-16"],["ngbTooltip","Remove","placement","top","data-bs-toggle","tooltip","data-bs-trigger","hover",1,"list-inline-item","me-0",3,"click"],[1,"text-danger","d-inline-block","remove-item-btn"],[1,"ri-delete-bin-5-fill","fs-16"]],template:function(i,n){1&i&&(e.nrm(0,"app-breadcrumbs",0),e.j41(1,"div",1)(2,"div",2)(3,"app-card")(4,"app-card-header")(5,"h5",3),e.EFF(6,"Faturas"),e.k0s(),e.j41(7,"div",4)(8,"app-button",5),e.bIt("click",function(){return n.create()}),e.EFF(9," Adicionar "),e.k0s()()(),e.j41(10,"app-card-body")(11,"app-table")(12,"thead",6)(13,"tr")(14,"th",7),e.EFF(15,"Name"),e.k0s(),e.j41(16,"th",8),e.EFF(17,"Action"),e.k0s()()(),e.j41(18,"tbody",9),e.DNE(19,G,10,1,"tr",10),e.k0s()()()()()()),2&i&&(e.Y8G("breadcrumbItems",n.breadCrumbItems),e.R7$(19),e.Y8G("ngForOf",n.invoices))},dependencies:[M.m,d.Sq,$.Q,T.i,V.l,S.q,B.O],encapsulation:2})}}return r})()},{path:"create",component:(()=>{class r{constructor(t){this.service=t,this.preview={items:[]},this.loading=!0,this.invoices=[],this.addresses=[],this.categories=[],this.filter={hasMeter:null,address:null,category:null}}ngOnInit(){this.load()}load(){this.loading=!0,this.service.preview("2025-01").subscribe({next:t=>{this.invoices=t,this.preview=this.buildPreview(t),this.loading=!1},error:()=>{this.loading=!1,this.preview.items=[]}})}filterByHasMeter(t){return null===this.filter.hasMeter?t:t.filter(i=>i.category.is_hydrometer===this.filter.hasMeter)}filterByAddress(t){return this.filter.address?t.filter(i=>i.place.address===this.filter.address):t}filterByCategory(t){return this.filter.category?t.filter(i=>i.category.name===this.filter.category):t}onchangeFilter(){let t=[...this.invoices];t=this.filterByHasMeter(t),t=this.filterByAddress(t),t=this.filterByCategory(t),this.preview=this.buildPreview(t)}getUniqueAddresses(t){return Array.from(new Set(t.map(i=>i.place.address))).sort((i,n)=>i.localeCompare(n))}getUniqueCategories(t){return Array.from(new Set(t.map(i=>i.category.name))).sort((i,n)=>i.localeCompare(n))}createSelectableInvoices(t){return t.map(i=>({checked:!1,...i}))}buildPreview(t){const i=this.createSelectableInvoices(t),n=this.getUniqueAddresses(i),o=this.getUniqueCategories(i),c=n.map(v=>({name:v,checked:!1,items:i.filter(X=>X.place.address===v)}));return 0===this.addresses.length&&(this.addresses=n),0===this.categories.length&&(this.categories=o),{items:c}}trackByGroupId(t){return t.id}trackBySelectableId(t){return t.id}totalItems(){return this.preview.items.reduce((t,i)=>t+i.items.length,0)}totalValue(){return this.preview.items.reduce((t,i)=>t+i.items.reduce((n,o)=>n+Number(o.total),0),0)}totalISelectedtems(){return this.preview.items.reduce((t,i)=>t+i.items.filter(n=>n.checked).length,0)}totalSelectedValue(){return this.preview.items.reduce((t,i)=>t+i.items.filter(n=>n.checked).reduce((n,o)=>n+(Number(o.total)??0),0),0)}toggleGroup(t){t.checked=!t.checked,t.items.forEach(i=>i.checked=t.checked)}toggleAll(){const t=this.preview.items.every(i=>i.checked&&i.items.every(n=>n.checked));this.preview.items.forEach(i=>{i.checked=!t,i.items.forEach(n=>n.checked=!t)})}static{this.\u0275fac=function(i){return new(i||r)(e.rXU(u))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-invoice-create"]],decls:69,vars:20,consts:[[1,"d-flex","flex-column",2,"height","100vh"],[2,"height","10vh"],[1,"border","h-100"],[1,"card"],[1,"card-body"],[1,"row"],[1,"col-xxl-4","col-md-6"],[1,"form-label"],["id","group",1,"form-select",3,"ngModelChange","change","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["id","hasMeterFilter",1,"form-select",3,"ngModelChange","change","ngModel"],[2,"height","60vh"],[1,"border","h-100","d-flex","flex-column"],[1,"border","mb-0","flex-grow-1","overflow-auto"],[1,"table","table-hover","table-striped","mb-0",2,"min-width","100%"],[1,"table-light",2,"position","sticky","top","0","z-index","1"],[2,"cursor","pointer",3,"click"],[2,"width","20%"],[2,"width","15%"],[2,"width","5%"],["table-body","",1,"list","form-check-all"],[4,"ngFor","ngForOf","ngForTrackBy"],[2,"height","20vh"],[1,"col-md-3","col-12"],[1,"bg-light",3,"click","ngClass"],["colspan","7"],[1,"text-center","fw-bold",2,"font-size","16px"],[1,"text-center"],["type","checkbox",3,"ngModelChange","click","ngModel"],["style","cursor: pointer",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[2,"cursor","pointer",3,"click","ngClass"]],template:function(i,n){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"label",7),e.EFF(8,"Categorias:"),e.k0s(),e.j41(9,"select",8),e.mxI("ngModelChange",function(c){return e.DH7(n.filter.category,c)||(n.filter.category=c),c}),e.bIt("change",function(){return n.onchangeFilter()}),e.j41(10,"option",9),e.EFF(11,"Selecione..."),e.k0s(),e.DNE(12,U,2,2,"option",10),e.k0s()(),e.j41(13,"div",6)(14,"label",7),e.EFF(15,"Logradouro:"),e.k0s(),e.j41(16,"select",8),e.mxI("ngModelChange",function(c){return e.DH7(n.filter.address,c)||(n.filter.address=c),c}),e.bIt("change",function(){return n.onchangeFilter()}),e.j41(17,"option",9),e.EFF(18,"Selecione..."),e.k0s(),e.DNE(19,Y,2,2,"option",10),e.k0s()(),e.j41(20,"div",6)(21,"label",7),e.EFF(22,"Tem Hidr\xf4metro?:"),e.k0s(),e.j41(23,"select",11),e.mxI("ngModelChange",function(c){return e.DH7(n.filter.hasMeter,c)||(n.filter.hasMeter=c),c}),e.bIt("change",function(){return n.onchangeFilter()}),e.j41(24,"option",9),e.EFF(25,"Selecione..."),e.k0s(),e.j41(26,"option",9),e.EFF(27,"Sim"),e.k0s(),e.j41(28,"option",9),e.EFF(29,"N\xe3o"),e.k0s()()()()()()()(),e.j41(30,"div",12)(31,"div",13)(32,"div",14)(33,"table",15)(34,"thead",16)(35,"tr",17),e.bIt("click",function(){return n.toggleAll()}),e.j41(36,"th",18),e.EFF(37,"Endereco"),e.k0s(),e.j41(38,"th",19),e.EFF(39,"Name"),e.k0s(),e.j41(40,"th",19),e.EFF(41,"Categoria"),e.k0s(),e.j41(42,"th",20),e.EFF(43,"\xc1gua/lt"),e.k0s(),e.j41(44,"th",20),e.EFF(45,"\xc1gua/Consumo"),e.k0s(),e.j41(46,"th",20),e.EFF(47,"N\xfamero"),e.k0s(),e.j41(48,"th",20),e.EFF(49,"Valor"),e.k0s(),e.j41(50,"th",20),e.EFF(51,"Selecionar"),e.k0s()()(),e.j41(52,"tbody",21),e.DNE(53,D,9,7,"ng-container",22),e.k0s()()()()(),e.j41(54,"div",23)(55,"div",2)(56,"div",3)(57,"div",4)(58,"div",5)(59,"div",24),e.EFF(60),e.k0s(),e.j41(61,"div",24),e.EFF(62),e.nI1(63,"currency"),e.k0s(),e.j41(64,"div",24),e.EFF(65),e.k0s(),e.j41(66,"div",24),e.EFF(67),e.nI1(68,"currency"),e.k0s()()()()()()()),2&i&&(e.R7$(9),e.R50("ngModel",n.filter.category),e.R7$(),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngForOf",n.categories),e.R7$(4),e.R50("ngModel",n.filter.address),e.R7$(),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngForOf",n.addresses),e.R7$(4),e.R50("ngModel",n.filter.hasMeter),e.R7$(),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngValue",!0),e.R7$(2),e.Y8G("ngValue",!1),e.R7$(25),e.Y8G("ngForOf",n.preview.items)("ngForTrackBy",n.trackByGroupId),e.R7$(7),e.SpI("Total de items: ",n.totalItems(),""),e.R7$(2),e.SpI("Valor Total: ",e.bMT(63,16,n.totalValue()),""),e.R7$(3),e.SpI("Items Selecionados: ",n.totalISelectedtems(),""),e.R7$(2),e.SpI("Valor Selecionado: ",e.bMT(68,18,n.totalSelectedValue()),""))},dependencies:[d.YU,d.Sq,l.xH,l.y7,l.Zm,l.wz,l.BC,l.vS,d.oe],encapsulation:2})}}return r})()}];let x=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[m.iI.forChild(O),m.iI]})}}return r})();var A=s(7038);let H=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({providers:[d.vh],imports:[j.G,x,d.MD,f.h,b.i,l.YN,l.X1,h.c9,h.h_,h.zH,I.r,F.M.pick(k.Wzl),C.ND,y.V,A.H]})}}return r})()}}]);
"use strict";(self.webpackChunkvelzon=self.webpackChunkvelzon||[]).push([[206],{4206:(q,g,s)=>{s.r(g),s.d(g,{InvoiceModule:()=>Z});var d=s(177),a=s(9417),p=s(9005),I=s(8147),_=s(5464),b=s(6411),j=s(1022),y=s(255),R=s(115),E=s(3887),V=s(1114),u=s(1188),e=s(4438),T=s(5312),x=s(1626);let f=(()=>{class r{constructor(t){this.http=t,this.apiUrl=`${T.c.apiUrl}/invoice`}get(){return this.http.get(this.apiUrl)}paginate(t){return this.http.post(`${this.apiUrl}/paginate`,t)}create(t){return this.http.post(`${this.apiUrl}/all`,t)}update(t){return this.http.put(this.apiUrl,t)}delete(t){return this.http.delete(`${this.apiUrl}/${t}`)}preview(t){return this.http.get(`${this.apiUrl}/preview/${t}`)}static{this.\u0275fac=function(n){return new(n||r)(e.KVO(x.Qq))}}static{this.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var $=s(7509),M=s(9459),v=s(6356),G=s(7186),F=s(43),S=s(272),N=s(9986),B=s(1272);function D(r,l){if(1&r){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.nI1(13,"currency"),e.k0s(),e.j41(14,"td",9)(15,"ul",10)(16,"li",11),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.edit(i))}),e.nrm(17,"i",12),e.k0s(),e.j41(18,"li",13),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.delete(i))}),e.j41(19,"a",14),e.nrm(20,"i",15),e.k0s()()()()()}if(2&r){const t=l.$implicit;e.R7$(2),e.JRh(t.reference),e.R7$(2),e.JRh(t.due_date),e.R7$(2),e.JRh(t.place.address),e.R7$(2),e.JRh(t.customer.name),e.R7$(2),e.JRh(t.category.name),e.R7$(2),e.JRh(e.bMT(13,6,t.total))}}let Y=(()=>{class r{constructor(t,n,i,o,c){this.router=t,this.route=n,this.invoiceService=i,this.modalService=o,this.toastService=c,this.filter={page:0,size:10,sort_orders:[{property:"created_at",direction:"DESC"}]},this.loading=!0}ngOnInit(){this.search()}search(){this.loading=!0,this.invoiceService.paginate(this.filter).subscribe({next:t=>{this.page=t,this.loading=!1},error:()=>{this.loading=!1}})}onPageChange(t){this.filter.page=t-1,this.search()}create(){this.router.navigate(["create"],{relativeTo:this.route})}edit(t){}delete(t){}openModal(t,n){const o=this.modalService.open(t,{centered:!0}).componentInstance;n&&Object.assign(o,n),o.sent.subscribe(()=>this.search())}static{this.\u0275fac=function(n){return new(n||r)(e.rXU(u.Ix),e.rXU(u.nX),e.rXU(f),e.rXU(p.Bq),e.rXU($.f))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-invoice"]],decls:29,vars:4,consts:[[1,"row"],[1,"col-lg-12"],[1,"card-title","flex-grow-1","mb-0"],[1,"d-flex","gap-1","flex-wrap"],["btnType","success","outline","",3,"click"],["table-header","",1,"table-light"],["table-body","",1,"list","form-check-all"],[4,"ngFor","ngForOf"],[3,"pageChange","page","pageSize","totalItems"],[1,"text-center"],[1,"list-inline","hstack","gap-2","mb-0"],["data-bs-toggle","tooltip","data-bs-trigger","hover","ngbTooltip","Edit","placement","top",1,"list-inline-item","edit",3,"click"],[1,"ri-pencil-fill","fs-16"],["ngbTooltip","Remove","placement","top","data-bs-toggle","tooltip","data-bs-trigger","hover",1,"list-inline-item","me-0",3,"click"],[1,"text-danger","d-inline-block","remove-item-btn"],[1,"ri-delete-bin-5-fill","fs-16"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"app-card")(3,"app-card-header")(4,"h5",2),e.EFF(5,"Faturas"),e.k0s(),e.j41(6,"div",3)(7,"app-button",4),e.bIt("click",function(){return i.create()}),e.EFF(8," Adicionar "),e.k0s()()(),e.j41(9,"app-card-body")(10,"app-table")(11,"thead",5)(12,"tr")(13,"th"),e.EFF(14,"Refererencia"),e.k0s(),e.j41(15,"th"),e.EFF(16,"Vencimento"),e.k0s(),e.j41(17,"th"),e.EFF(18,"Endere\xe7o"),e.k0s(),e.j41(19,"th"),e.EFF(20,"Cliente"),e.k0s(),e.j41(21,"th"),e.EFF(22,"Categoria"),e.k0s(),e.j41(23,"th"),e.EFF(24,"Total"),e.k0s()()(),e.j41(25,"tbody",6),e.DNE(26,D,21,8,"tr",7),e.k0s()()(),e.j41(27,"app-card-footer")(28,"app-pagination",8),e.bIt("pageChange",function(c){return i.onPageChange(c)}),e.k0s()()()()()),2&n&&(e.R7$(26),e.Y8G("ngForOf",i.page.content),e.R7$(2),e.Y8G("page",i.filter.page+1)("pageSize",i.filter.size)("totalItems",(null==i.page?null:i.page.total_elements)||0))},dependencies:[d.Sq,M.Q,v.i,G.l,F.q,S.R,N.O,B.e,d.oe],encapsulation:2})}}return r})();class C{static valid(){return l=>{const t=l.value;if(!t||8!==t.length)return{invalidFormat:!0};const n=parseInt(t.substring(0,4),10),i=parseInt(t.substring(4,6),10),o=parseInt(t.substring(6,8),10);if(isNaN(n)||isNaN(i)||isNaN(o))return{invalidCharacters:!0};if(n<1900||n>2100)return{invalidYear:!0};const c=new Date(n,i-1,o);return c.getFullYear()===n&&c.getMonth()===i-1&&c.getDate()===o?null:{invalidDate:!0}}}}var X=s(9830);function w(r,l){1&r&&(e.j41(0,"div",2),e.EFF(1,"Data inv\xe1lida"),e.k0s())}let U=(()=>{class r{constructor(){this.placeholder="YYYY-MM-DD",this.reference=new a.MJ("",[a.k0.required,C.valid()]),this.onChange=()=>{},this.onTouched=()=>{}}ngOnChanges(t){t.submitted&&!0===t.submitted.currentValue&&!0!==t.submitted.previousValue&&(this.reference.markAsTouched(),this.reference.updateValueAndValidity({onlySelf:!0,emitEvent:!1}))}writeValue(t){if(!t)return void this.reference.setValue("",{emitEvent:!1});const n=t instanceof Date?t.toISOString().substring(0,10):t;this.reference.setValue(n,{emitEvent:!1})}registerOnChange(t){this.onChange=t,this.reference.valueChanges.subscribe(n=>{if(!n)return void this.onChange(null);const i=n.split("-");if(3===i.length){const[o,c,h]=i.map(Number),m=new Date(o,c-1,h);this.onChange(m)}else this.onChange(null)})}registerOnTouched(t){this.onTouched=t}setDisabledState(t){t?this.reference.disable():this.reference.enable()}validate(t){const n=[a.k0.required,C.valid()],i=a.k0.compose(n);return i?i(t):null}isInvalid(){return!!this.submitted&&this.reference.touched&&this.reference.invalid}isValid(){return!!this.submitted&&this.reference.touched&&this.reference.valid}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-input-date"]],inputs:{submitted:"submitted",placeholder:"placeholder"},features:[e.Jv_([{provide:a.kq,useExisting:(0,e.Rfq)(()=>r),multi:!0},{provide:a.cz,useExisting:(0,e.Rfq)(()=>r),multi:!0}]),e.OA$],decls:2,vars:4,consts:[["type","text","mask","0000-00-00",1,"form-control",3,"dropSpecialCharacters","formControl","placeholder"],["class","text-danger",4,"ngIf"],[1,"text-danger"]],template:function(n,i){1&n&&(e.nrm(0,"input",0),e.DNE(1,w,2,0,"div",1)),2&n&&(e.Y8G("dropSpecialCharacters",!1)("formControl",i.reference)("placeholder",i.placeholder),e.R7$(),e.Y8G("ngIf",i.isInvalid()))},dependencies:[d.bT,a.me,a.BC,a.l_,X.Zr],encapsulation:2})}}return r})();var O=s(9743);const k=r=>({"table-success":r});function J(r,l){if(1&r){const t=e.RV6();e.j41(0,"app-card")(1,"app-card-body")(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),e.EFF(6,"Refer\xeancia"),e.k0s(),e.j41(7,"app-input-reference",6),e.mxI("ngModelChange",function(i){e.eBV(t);const o=e.XpG();return e.DH7(o.reference,i)||(o.reference=i),e.Njj(i)}),e.k0s()()(),e.nrm(8,"hr"),e.j41(9,"div",7)(10,"div",8)(11,"label",9),e.EFF(12,"Buscar"),e.k0s(),e.j41(13,"button",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.search())}),e.nrm(14,"i",11),e.EFF(15," Buscar"),e.k0s()()()()()()}if(2&r){const t=e.XpG();e.R7$(7),e.R50("ngModel",t.reference)}}function A(r,l){if(1&r&&(e.j41(0,"option",19),e.EFF(1),e.k0s()),2&r){const t=l.$implicit;e.Y8G("ngValue",t),e.R7$(),e.JRh(t)}}function z(r,l){if(1&r&&(e.j41(0,"option",19),e.EFF(1),e.k0s()),2&r){const t=l.$implicit;e.Y8G("ngValue",t),e.R7$(),e.JRh(t)}}function H(r,l){if(1&r){const t=e.RV6();e.j41(0,"tr",42),e.bIt("click",function(){const i=e.eBV(t).$implicit;return e.Njj(i.checked=!i.checked)}),e.j41(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.nI1(9,"currency"),e.k0s(),e.j41(10,"td"),e.EFF(11),e.k0s(),e.j41(12,"td",43),e.EFF(13),e.nI1(14,"currency"),e.k0s()()}if(2&r){const t=l.$implicit;e.Y8G("ngClass",e.eq3(11,k,t.checked)),e.R7$(2),e.JRh(t.place.number),e.R7$(2),e.JRh(t.customer.name),e.R7$(2),e.JRh(t.category.name),e.R7$(2),e.JRh(e.bMT(9,7,t.water_value)),e.R7$(3),e.JRh(t.consumption),e.R7$(2),e.JRh(e.bMT(14,9,t.total))}}function P(r,l){if(1&r){const t=e.RV6();e.qex(0),e.j41(1,"tr",38),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.toggleGroup(i))}),e.j41(2,"td",39)(3,"div",7)(4,"div",40),e.EFF(5),e.k0s()()()(),e.DNE(6,H,15,13,"tr",41),e.bVm()}if(2&r){const t=l.$implicit,n=e.XpG(2);e.R7$(),e.Y8G("ngClass",e.eq3(4,k,t.checked)),e.R7$(4),e.SpI(" ",t.name," "),e.R7$(),e.Y8G("ngForOf",t.items)("ngForTrackBy",n.trackBySelectableId)}}function Q(r,l){if(1&r){const t=e.RV6();e.j41(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15)(4,"div",16)(5,"div",7)(6,"div",17)(7,"label",5),e.EFF(8,"Categorias:"),e.k0s(),e.j41(9,"select",18),e.mxI("ngModelChange",function(i){e.eBV(t);const o=e.XpG();return e.DH7(o.filter.category,i)||(o.filter.category=i),e.Njj(i)}),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onchangeFilter())}),e.j41(10,"option",19),e.EFF(11,"Selecione..."),e.k0s(),e.DNE(12,A,2,2,"option",20),e.k0s()(),e.j41(13,"div",17)(14,"label",5),e.EFF(15,"Logradouro:"),e.k0s(),e.j41(16,"select",18),e.mxI("ngModelChange",function(i){e.eBV(t);const o=e.XpG();return e.DH7(o.filter.address,i)||(o.filter.address=i),e.Njj(i)}),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onchangeFilter())}),e.j41(17,"option",19),e.EFF(18,"Selecione..."),e.k0s(),e.DNE(19,z,2,2,"option",20),e.k0s()(),e.j41(20,"div",17)(21,"label",5),e.EFF(22,"Tem Hidr\xf4metro?:"),e.k0s(),e.j41(23,"select",21),e.mxI("ngModelChange",function(i){e.eBV(t);const o=e.XpG();return e.DH7(o.filter.hasMeter,i)||(o.filter.hasMeter=i),e.Njj(i)}),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onchangeFilter())}),e.j41(24,"option",19),e.EFF(25,"Selecione..."),e.k0s(),e.j41(26,"option",19),e.EFF(27,"Sim"),e.k0s(),e.j41(28,"option",19),e.EFF(29,"N\xe3o"),e.k0s()()()()()()()(),e.j41(30,"div",22)(31,"div",23)(32,"div",24)(33,"table",25)(34,"thead",26)(35,"tr",27),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleAll())}),e.j41(36,"th",28),e.EFF(37,"N\xfamero"),e.k0s(),e.j41(38,"th",29),e.EFF(39,"Categoria"),e.k0s(),e.j41(40,"th",30),e.EFF(41,"Name"),e.k0s(),e.j41(42,"th",31),e.EFF(43,"\xc1gua/lt"),e.k0s(),e.j41(44,"th",31),e.EFF(45,"\xc1gua/Consumo"),e.k0s(),e.j41(46,"th",32),e.EFF(47,"Valor"),e.k0s()()(),e.j41(48,"tbody",33),e.DNE(49,P,7,6,"ng-container",34),e.k0s()()()()(),e.j41(50,"div",35)(51,"div",14)(52,"app-card")(53,"app-card-body")(54,"div",7)(55,"div",36),e.EFF(56),e.k0s(),e.j41(57,"div",36),e.EFF(58),e.nI1(59,"currency"),e.k0s(),e.j41(60,"div",36),e.EFF(61),e.k0s(),e.j41(62,"div",36),e.EFF(63),e.nI1(64,"currency"),e.k0s()()(),e.j41(65,"app-card-body")(66,"div",2)(67,"div",7)(68,"div",37)(69,"app-input-date",6),e.mxI("ngModelChange",function(i){e.eBV(t);const o=e.XpG();return e.DH7(o.dueDate,i)||(o.dueDate=i),e.Njj(i)}),e.k0s()()(),e.j41(70,"div",7)(71,"div",37)(72,"button",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.confirm())}),e.EFF(73,"Confirmar"),e.k0s()()()()()()()()()}if(2&r){const t=e.XpG();e.R7$(9),e.R50("ngModel",t.filter.category),e.R7$(),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngForOf",t.categories),e.R7$(4),e.R50("ngModel",t.filter.address),e.R7$(),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngForOf",t.addresses),e.R7$(4),e.R50("ngModel",t.filter.hasMeter),e.R7$(),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngValue",!0),e.R7$(2),e.Y8G("ngValue",!1),e.R7$(21),e.Y8G("ngForOf",t.preview.items)("ngForTrackBy",t.trackByGroupId),e.R7$(7),e.SpI("Total de items: ",t.totalItems(),""),e.R7$(2),e.SpI("Valor Total: ",e.bMT(59,17,t.totalValue()),""),e.R7$(3),e.SpI("Items Selecionados: ",t.totalISelectedtems(),""),e.R7$(2),e.SpI("Valor Selecionado: ",e.bMT(64,19,t.totalSelectedValue()),""),e.R7$(6),e.R50("ngModel",t.dueDate)}}const K=[{path:"",component:Y},{path:"create",component:(()=>{class r{constructor(t){this.service=t,this.reference=null,this.dueDate=null,this.preview={items:[]},this.loading=!0,this.invoices=[],this.addresses=[],this.categories=[],this.filter={hasMeter:null,address:null,category:null}}ngOnInit(){}search(){this.loading=!0,this.reference&&this.service.preview(this.reference).subscribe({next:t=>{this.invoices=t,this.preview=this.buildPreview(t),this.loading=!1},error:()=>{this.loading=!1,this.preview.items=[]}})}confirm(){const t=this.preview.items.flatMap(n=>n.items).filter(n=>n.checked);t.forEach(n=>{n.due_date=this.dueDate}),this.service.create(t).subscribe({next:n=>{this.preview.items=this.preview.items.map(i=>({...i,items:i.items.filter(o=>!o.checked)}))},error:()=>{}})}filterByHasMeter(t){return null===this.filter.hasMeter?t:t.filter(n=>n.category.is_hydrometer===this.filter.hasMeter)}filterByAddress(t){return this.filter.address?t.filter(n=>n.place.address===this.filter.address):t}filterByCategory(t){return this.filter.category?t.filter(n=>n.category.name===this.filter.category):t}onchangeFilter(){let t=[...this.invoices];t=this.filterByHasMeter(t),t=this.filterByAddress(t),t=this.filterByCategory(t),this.preview=this.buildPreview(t)}getUniqueAddresses(t){return Array.from(new Set(t.map(n=>n.place.address))).sort((n,i)=>n.localeCompare(i))}getUniqueCategories(t){return Array.from(new Set(t.map(n=>n.category.name))).sort((n,i)=>n.localeCompare(i))}createSelectableInvoices(t){return t.map(n=>({checked:!1,...n}))}buildPreview(t){const n=this.createSelectableInvoices(t),i=this.getUniqueAddresses(n),o=this.getUniqueCategories(n),c=i.map(h=>({name:h,checked:!1,items:n.filter(m=>m.place.address===h)}));return 0===this.addresses.length&&(this.addresses=i),0===this.categories.length&&(this.categories=o),{items:c}}trackByGroupId(t){return t.id}trackBySelectableId(t){return t.id}totalItems(){return this.preview.items.reduce((t,n)=>t+n.items.length,0)}totalValue(){return this.preview.items.reduce((t,n)=>t+n.items.reduce((i,o)=>i+Number(o.total),0),0)}totalISelectedtems(){return this.preview.items.reduce((t,n)=>t+n.items.filter(i=>i.checked).length,0)}totalSelectedValue(){return this.preview.items.reduce((t,n)=>t+n.items.filter(i=>i.checked).reduce((i,o)=>i+(Number(o.total)??0),0),0)}toggleGroup(t){t.checked=!t.checked,t.items.forEach(n=>n.checked=t.checked)}toggleAll(){const t=this.preview.items.every(n=>n.checked&&n.items.every(i=>i.checked));this.preview.items.forEach(n=>{n.checked=!t,n.items.forEach(i=>i.checked=!t)})}static{this.\u0275fac=function(n){return new(n||r)(e.rXU(f))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-invoice-create"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","d-flex flex-column","style","height: 100vh",4,"ngIf"],[1,"container-fluid"],[1,"row","g-2","align-items-end"],[1,"col-md-6","col-12"],[1,"form-label"],[3,"ngModelChange","ngModel"],[1,"row"],[1,"col-12","col-md-4","offset-md-8","d-grid"],[1,"form-label","invisible"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"mdi","mdi-magnify"],[1,"d-flex","flex-column",2,"height","100vh"],[2,"height","10vh"],[1,"border","h-100"],[1,"card"],[1,"card-body"],[1,"col-xxl-4","col-md-6"],["id","group",1,"form-select",3,"ngModelChange","change","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["id","hasMeterFilter",1,"form-select",3,"ngModelChange","change","ngModel"],[2,"height","60vh"],[1,"border","h-100","d-flex","flex-column"],[1,"border","mb-0","flex-grow-1","overflow-auto"],[1,"table","table-hover","table-bordered","table-striped","mb-0",2,"min-width","100%"],[1,"table-light",2,"position","sticky","top","0","z-index","1"],[2,"cursor","pointer",3,"click"],[2,"width","5%"],[2,"width","20%"],[2,"width","35%"],[2,"width","10%"],[1,"text-center",2,"width","10%"],["table-body","",1,"list","form-check-all"],[4,"ngFor","ngForOf","ngForTrackBy"],[2,"height","20vh"],[1,"col-md-3","col-12"],[1,"col-12","col-md-3","offset-md-9","d-grid"],[1,"bg-light",3,"click","ngClass"],["colspan","6"],[1,"text-center","fw-bold",2,"font-size","16px"],["style","cursor: pointer",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[2,"cursor","pointer",3,"click","ngClass"],[1,"text-center"]],template:function(n,i){1&n&&e.DNE(0,J,16,1,"app-card",0)(1,Q,74,21,"div",1),2&n&&(e.Y8G("ngIf",i.loading),e.R7$(),e.Y8G("ngIf",!i.loading))},dependencies:[d.YU,d.Sq,d.bT,v.i,F.q,U,O.F,a.xH,a.y7,a.wz,a.BC,a.vS,d.oe],encapsulation:2})}}return r})()}];let L=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[u.iI.forChild(K),u.iI]})}}return r})();var W=s(7038);let Z=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({providers:[d.vh],imports:[E.G,L,d.MD,I.h,R.i,a.YN,a.X1,p.c9,p.h_,p.zH,y.r,_.M.pick(b.Wzl),j.ND,V.V,W.H]})}}return r})()}}]);